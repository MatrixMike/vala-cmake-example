#
#
# Static Library Target: linked against main and against tests.

vala_precompile(MY_PROJECT_C_SOURCES
    "${CMAKE_CURRENT_BINARY_DIR}/config.vala"
	my_class.vala
PACKAGES
	gio-2.0
	gee-0.8
	posix
GENERATE_HEADER
	my-project-${MY_PROJECT_VERSION_API}
GENERATE_VAPI
	my-project-${MY_PROJECT_VERSION_API})

add_library(my-project-${MY_PROJECT_VERSION_API}
	${MY_PROJECT_C_SOURCES}
)

set_target_properties ("my-project-${MY_PROJECT_VERSION_API}" PROPERTIES
	SOVERSION "${MY_PROJECT_SOVERSION_CURRENT}.${MY_PROJECT_SOVERSION_REVISION}.${MY_PROJECT_SOVERSION_AGE}"
	VERSION   "${MY_PROJECT_SOVERSION_CURRENT}.${MY_PROJECT_SOVERSION_REVISION}")

install (TARGETS my-project-${MY_PROJECT_VERSION_API}
	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR})
install(FILES ${CMAKE_BINARY_DIR}/src_lib/my-project-${MY_PROJECT_VERSION_API}.h
	DESTINATION ${CMAKE_INSTALL_FULL_INCLUDEDIR})

configure_file (
    "${CMAKE_CURRENT_SOURCE_DIR}/my-project.pc.in"
    "${CMAKE_CURRENT_BINARY_DIR}/my-project-${MY_PROJECT_VERSION_API}.pc"
    @ONLY)

configure_file (
    "${CMAKE_CURRENT_SOURCE_DIR}/config.vala.in"
    "${CMAKE_CURRENT_BINARY_DIR}/config.vala"
    @ONLY)

install(FILES ${CMAKE_CURRENT_BINARY_DIR}/my-project-${MY_PROJECT_VERSION_API}.pc
  DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)

# Generate a .gitignore
file(WRITE  ".gitignore" "# Automatically generated by CMake, do not modify.\n")
foreach(file
    ".gitignore"
    "${CMAKE_SHARED_LIBRARY_PREFIX}my-project-${MY_PROJECT_VERSION_API}${CMAKE_SHARED_LIBRARY_SUFFIX}"
    "${CMAKE_STATIC_LIBRARY_PREFIX}my-project-${MY_PROJECT_VERSION_API}${CMAKE_STATIC_LIBRARY_SUFFIX}"
    "my-project-${MY_PROJECT_VERSION_API}.pc"
    "config.vala")
  file(APPEND ".gitignore" "/${file}\n")
endforeach(file)
foreach(file ${MY_PROJECT_C_SOURCES})
  string(REPLACE "${CMAKE_CURRENT_BINARY_DIR}/" "" file ${file})
  file(APPEND ".gitignore" "/${file}\n")
endforeach(file)
