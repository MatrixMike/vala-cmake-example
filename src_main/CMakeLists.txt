#
#
# Main target

# You can re-type these if you prefer, but putting them in variables
# makes it easier to reuse them, and helps explain what each command
# needs to include.

# These are the Vala sources you want to build your library out of.
set(MY_PROJECT_VALA_SOURCES
    main.vala)

# Any dependencies.
set(MY_PROJECT_VALA_PACKAGES
    gio-2.0
    gee-0.8)

# Any custom vapis.
set(MY_PROJECT_VALA_CUSTOM_VAPIS
    ${CMAKE_BINARY_DIR}/${LIBRAR_PATH}/${MY_PROJECT_HEADER}.vapi)

# Compile Vala -> C
vala_precompile(
    # vala_precompile will populate the MY_PROJECT_C_TEST_SOURCES variable
    # with the list of files generated by valac.
    MY_PROJECT_C_TEST_SOURCES
    ${MY_PROJECT_VALA_SOURCES}
    PACKAGES ${MY_PROJECT_VALA_PACKAGES}
    CUSTOM_VAPIS ${MY_PROJECT_VALA_CUSTOM_VAPIS})

add_executable(${PROJECT_NAME}
	${MY_PROJECT_C_TEST_SOURCES}
)

set_target_properties(${PROJECT_NAME} PROPERTIES
	INCLUDE_DIRECTORIES ${CMAKE_BINARY_DIR}/${LIBRAR_PATH})

target_link_libraries(${PROJECT_NAME} ${MY_PROJECT_LIBRARY_NAME} -lm)

install (TARGETS ${PROJECT_NAME}
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})

# Generate a .gitignore
file(WRITE  ".gitignore" "# Automatically generated by CMake, do not modify.\n")
foreach(file
    ".gitignore"
    "${PROJECT_NAME}${CMAKE_EXECUTABLE_SUFFIX}")
  file(APPEND ".gitignore" "/${file}\n")
endforeach(file)
foreach(file ${MY_PROJECT_C_TEST_SOURCES})
  string(REPLACE "${CMAKE_CURRENT_BINARY_DIR}/" "" file ${file})
  file(APPEND ".gitignore" "/${file}\n")
endforeach(file)
